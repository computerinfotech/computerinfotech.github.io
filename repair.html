<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Computer Infotech - Job Receipt</title>

<link rel="icon" href="favicon.ico">
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>

<style>
body{font-family:Arial;background:#FFF8E1;margin:0}
h3{text-align:center;margin:6px 0}
fieldset{margin:20px;padding:15px;border:2px solid #2E7D32;background:#FFFDE7}
table{width:100%;border-collapse:collapse;margin-bottom:10px}
th,td{border:1px solid #2E7D32;padding:7px;text-align:center}
th{background:#C8E6C9}
input,select{
 width:95%;padding:5px;font-weight:bold;
 text-align:center;text-transform:uppercase
}
.total{background:#FFEB3B}
.bar{text-align:center;margin:8px 0;font-weight:bold}
.signature{display:flex;justify-content:space-between;margin-top:25px}
button{
 padding:10px 20px;font-size:16px;
 background:#2E7D32;color:#fff;
 border:none;border-radius:5px;cursor:pointer
}
@media print{button{display:none}}
</style>

<script>
/* ===== START REGISTRATION ===== */
const START_REG = 652;

/* ===== INIT ===== */
let regNo = parseInt(localStorage.getItem("CI_REG"));
if(isNaN(regNo)||regNo<START_REG){
 regNo=START_REG;
 localStorage.setItem("CI_REG",regNo);
}

function regText(){
 return "CI/PRD-"+regNo+"/25-26";
}

/* ===== BARCODE ===== */
function loadBarcode(){
 r_i.innerText="Registration No. : "+regText();
 r_c.innerText="Registration No. : "+regText();
 JsBarcode("#b_i",regText(),{height:45});
 JsBarcode("#b_c",regText(),{height:45});
}

/* ===== SYNC ===== */
function sync(){
 let f=["name","address","mobile","qnty","product","model","charger",
        "problem","pin","job","recv","del","amt","tech","status"];
 f.forEach(x=>{
  let i=document.getElementById("i_"+x);
  let c=document.getElementById("c_"+x);
  if(i&&c) c.value=i.value.toUpperCase();
 });
}

/* ===== LAPTOP PIN ===== */
function togglePin(sel){
 if(sel.value==="LAPTOP"){
  pin_td.style.display="table-cell";
 }else{
  pin_td.style.display="none";
  i_pin.value=""; c_pin.value="";
 }
 sync();
}

/* ===== SAVE JOB ===== */
function saveJob(){
 let job = i_job.value;
 if(!job) return;

 let data={};
 ["name","address","mobile","qnty","product","model","charger",
  "problem","pin","job","recv","del","amt","tech","status"].forEach(x=>{
   data[x]=document.getElementById("i_"+x).value;
 });
 localStorage.setItem("JOB_"+job,JSON.stringify(data));
 localStorage.setItem("MOB_"+data.mobile,job);
}

/* ===== SEARCH JOB ===== */
function searchJob(){
 let key=search_key.value.trim();
 if(!key){alert("Job No ya Mobile dijiye");return;}

 let job=key;
 if(key.length>=10) job=localStorage.getItem("MOB_"+key);

 let rec=localStorage.getItem("JOB_"+job);
 if(!rec){alert("Record nahi mila");return;}

 let data=JSON.parse(rec);
 for(let x in data){
  let i=document.getElementById("i_"+x);
  if(i) i.value=data[x];
 }
 togglePin(i_product);
 sync();
 alert("Old Job Loaded : "+job);
}

/* ===== PRINT (FINAL FIX) ===== */
function afterPrint(){
 saveJob();

 /* ðŸ‘‰ USER TYPED JOB NO SE NEXT JOB */
 let currentJob = parseInt(i_job.value);
 if(!isNaN(currentJob)){
   localStorage.setItem("CI_JOB_NEXT", currentJob+1);
 }

 /* REGISTRATION AUTO INCREASE */
 regNo++;
 localStorage.setItem("CI_REG",regNo);

 setTimeout(loadBarcode,100);
}

/* ===== AUTO NEXT JOB ===== */
function loadNextJob(){
 let n = parseInt(localStorage.getItem("CI_JOB_NEXT"));
 if(!isNaN(n)) i_job.value=n;
 sync();
}

window.onload=function(){
 loadBarcode();
 loadNextJob();
}
</script>
</head>

<body>

<!-- INTERNAL COPY -->
<h3><img src="ALC01.png" width="1024" height="149"></h3>
<h3>INTERNAL COPY</h3>

<div class="bar"><svg id="b_i"></svg><div id="r_i"></div></div>

<fieldset>

<table>
<tr><th>Name</th><th>Address</th><th>Mobile</th></tr>
<tr>
<td><input id="i_name" oninput="sync()"></td>
<td><input id="i_address" oninput="sync()"></td>
<td><input id="i_mobile" oninput="sync()"></td>
</tr>
</table>


<table>
<tr>
<th>Qnty</th><th>Product</th><th>Model</th>
<th>Charger</th><th>Problem</th>
<th>Pin / Password </th>
</tr>
<tr>
<td><input id="i_qnty" oninput="sync()"></td>
<td>
<select id="i_product" onChange="togglePin(this)">
<option></option>
<option>LAPTOP</option><option>DESKTOP</option><option>CABINET / MOTHERBOX</option>
<option>PRINTER</option><option>SCANNER</option><option>MONITOR</option>
<option>KEYBOARD</option><option>MOUSE</option><option>SPEAKER</option>
<option>UPS</option><option>ROUTER</option><option>MODEM</option>
<option>CCTV CAMERA</option><option>DVR</option><option>NVR</option>
<option>PROJECTOR</option><option>OTHER</option>
</select>
</td>
<td><input id="i_model" oninput="sync()"></td>
<td>
<select id="i_charger" onChange="sync()">
<option>YES</option><option>NO</option>
</select>
</td>
<td><input id="i_problem" oninput="sync()"></td>
<td id="pin_td" style="display:none"><input id="i_pin" oninput="sync()"></td>
</tr>
</table>

<table>
<tr>
<th>Job No</th><th>Receive</th><th>Delivery</th>
<th class="total">Amount</th><th>Technician</th><th>Status</th>
</tr>
<tr>
<td><input id="i_job" oninput="sync()"></td>
<td><input id="i_recv" type="date" oninput="sync()"></td>
<td><input id="i_del" type="date" oninput="sync()"></td>
<td class="total"><input id="i_amt" oninput="sync()"></td>
<td><input id="i_tech" oninput="sync()"></td>
<td><input id="i_status" oninput="sync()"></td>
</tr>
</table>

<div style="margin-top:25px;font-weight:bold">Customer Signature</div>
</fieldset>

<!-- CUT HERE -->
<div style="display:flex;align-items:center;margin:30px">
<div style="flex:1;border-top:3px dashed #000"></div>
<span style="margin:0 12px;font-size:20px">âœ‚ CUT HERE âœ‚</span>
<div style="flex:1;border-top:3px dashed #000"></div>
</div>

<!-- CUSTOMER COPY -->
<h3><img src="ALC01.png" width="1024" height="149"></h3>
<h3>CUSTOMER COPY</h3>

<div class="bar"><svg id="b_c"></svg><div id="r_c"></div></div>

<fieldset>

<table>
<tr><th>Name</th><th>Address</th><th>Mobile</th></tr>
<tr>
<td><input id="c_name" readonly></td>
<td><input id="c_address" readonly></td>
<td><input id="c_mobile" readonly></td>
</tr>
</table>

<table>
<tr>
<th>Qnty</th><th>Product</th><th>Model</th>
<th>Charger</th><th>Problem</th>
<th>Pin / Password </th>
</tr>
<tr>
<td><input id="c_qnty" readonly></td>
<td><input id="c_product" readonly></td>
<td><input id="c_model" readonly></td>
<td><input id="c_charger" readonly></td>
<td><input id="c_problem" readonly></td>
<td><input id="c_pin" readonly></td>
</tr>
</table>

<table>
<tr>
<th>Job No</th><th>Receive</th><th>Delivery</th>
<th class="total">Amount</th><th>Technician</th><th>Status</th>
</tr>
<tr>
<td><input id="c_job" readonly></td>
<td><input id="c_recv" readonly></td>
<td><input id="c_del" readonly></td>
<td class="total"><input id="c_amt" readonly></td>
<td><input id="c_tech" readonly></td>
<td><input id="c_status" readonly></td>
</tr>
</table>

<div class="signature">
<div>Customer Signature</div>
<div>Authorized Signature</div>
</div>
</fieldset>

<center>
<button onClick="window.print();afterPrint()">PRINT</button>
</center>

</body>
</html>
