<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DOCUMENT RECORD SOFTWARE</title>

<style>
body{background:#fff8dc;font-family:Arial;font-weight:bold;text-transform:uppercase;margin:0}
.header{text-align:center;margin:10px 0}
.header-title{font-size:26px;color:#c40000}
.container{width:96%;margin:auto;background:#ffffcc;padding:15px;border-radius:6px;box-shadow:0 0 10px #777}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #000;padding:6px;text-align:center}
th{background:#e6f0ff;color:#003399}
input,select{width:95%;padding:6px;font-weight:bold;text-align:center;text-transform:uppercase}
button{padding:6px 12px;font-weight:bold;cursor:pointer}
.save{background:#4a90e2;color:#fff}
.preview{background:#6a1b9a;color:#fff}
.download{background:#2e7d32;color:#fff}
.delete{background:#c40000;color:#fff}

#previewBox{display:none;margin-top:15px;padding:10px;background:#fff;border:2px solid #000}
#previewBox iframe,#previewBox img{width:100%;height:450px;border:none}

#passOverlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:9999}
#passBox{background:#fff;width:300px;margin:150px auto;padding:20px;text-align:center;border-radius:6px}
#passBox input{width:90%;padding:8px;font-weight:bold}
</style>
</head>

<body oncontextmenu="return false">

<div class="header"><div class="header-title">DOCUMENT RECORD SOFTWARE</div></div>

<div class="container">

<table>
<tr>
<th>NAME</th>
<th>DOCUMENT TYPE</th>
<th>QUALIFICATION</th>
<th>UPLOAD</th>
</tr>
<tr>
<td><input id="custName"></td>

<td>
<select id="docType" onChange="docChange()">
<option value="">SELECT</option>
<option>PAN CARD</option>
<option>AADHAR CARD</option>
<option>LAND DEED</option>
<option>VOTER CARD</option>
<option>BIRTH CERTIFICATE</option>
<option>DRIVING LICENCE</option>
<option>PASSPORT</option>
<option>RATION CARD</option>
<option>INCOME CERTIFICATE</option>
<option>CASTE CERTIFICATE</option>
<option>DOMICILE CERTIFICATE</option>
<option>MARKSHEET</option>
<option>CERTIFICATE</option>
<option>ADMIT CARD</option>
</select>
</td>

<td>
<select id="qualification" style="display:none">
<option value="">SELECT</option>
</select>
</td>

<td><input type="file" id="file" accept=".pdf,.jpg,.jpeg,.png"></td>
</tr>
</table>

<br>
<center><button class="save" onClick="saveRecord()">SAVE RECORD</button></center>

<h3 align="center">SAVED DOCUMENTS</h3>
<table id="recordTable"></table>

<div id="previewBox"></div>
</div>

<div id="passOverlay">
<div id="passBox">
<h3>ENTER DOWNLOAD PASSWORD</h3>
<input type="password" id="passInput"><br><br>
<button onClick="checkPassword()">SUBMIT</button>
<button onClick="closePass()">CANCEL</button>
</div>
</div>

<script>
const DOWNLOAD_PASSWORD="Shail@2437";
let db,currentPreview=null,downloadData,downloadName;

/* DATABASE */
const req=indexedDB.open("PanDocumentDB",1);
req.onupgradeneeded=e=>{
 e.target.result.createObjectStore("documents",{keyPath:"id",autoIncrement:true});
};
req.onsuccess=e=>{db=e.target.result;showRecords();};

/* DOCUMENT CHANGE */
function docChange(){
  let options=[];
  if(docType.value==="MARKSHEET"||docType.value==="ADMIT CARD"){
    options=["MATRIC","INTERMEDIATE","GRADUATION","POST GRADUATION","B.ED","D.EL.ED"];
  }else if(docType.value==="CERTIFICATE"){
    options=["MATRIC","INTERMEDIATE","GRADUATION","POST GRADUATION","B.ED","D.EL.ED","SPORT","COMPUTER"];
  }
  if(options.length>0){
    qualification.innerHTML="<option value=''>SELECT</option>";
    options.forEach(o=>{qualification.innerHTML+=`<option>${o}</option>`});
    qualification.style.display="block";
  }else{
    qualification.style.display="none";
    qualification.value="";
  }
}

/* SAVE RECORD */
function saveRecord(){
 if(!custName.value||!docType.value||file.files.length==0){alert("ALL FIELDS REQUIRED");return;}
 if(qualification.style.display==="block"&&!qualification.value){alert("SELECT QUALIFICATION");return;}
 let r=new FileReader();
 r.onload=()=>{
   let tx=db.transaction("documents","readwrite");
   tx.objectStore("documents").add({
     name:custName.value,
     type:docType.value,
     qualification:qualification.value,
     fileName:file.files[0].name,
     fileData:r.result,
     fileType:file.files[0].type,
     time:new Date().toLocaleString()
   });
   tx.oncomplete=()=>{
     custName.value="";docType.value="";qualification.value="";qualification.style.display="none";file.value="";showRecords();
   }
 };
 r.readAsDataURL(file.files[0]);
}

/* SHOW RECORDS */
function showRecords(){
 recordTable.innerHTML=`
<tr><th>SL</th><th>NAME</th><th>TYPE</th><th>QUAL</th><th>FILE</th><th>TIME</th><th>ACTION</th></tr>`;
 let i=1;
 db.transaction("documents").objectStore("documents").openCursor().onsuccess=e=>{
   let c=e.target.result;
   if(c){
     let r=c.value;
     recordTable.innerHTML+=`
<tr>
<td>${i++}</td>
<td>${r.name}</td>
<td>${r.type}</td>
<td>${r.qualification||"-"}</td>
<td>${r.fileName}</td>
<td>${r.time}</td>
<td>
<button class="preview" onclick="previewDoc('${r.fileData}','${r.fileType}')">VIEW</button>
<button class="download" onclick="openPass('${r.fileData}','${r.fileName}')">DOWNLOAD</button>
<button class="delete" onclick="deleteRecord(${c.key})">DELETE</button>
</td>
</tr>`;
     c.continue();
   }
 };
}

/* PREVIEW */
function previewDoc(data,type){
 if(currentPreview===data){previewBox.style.display="none";currentPreview=null;return;}
 currentPreview=data;
 previewBox.style.display="block";
 previewBox.innerHTML=type.includes("pdf")?`<iframe src="${data}"></iframe>`:`<img src="${data}">`;
}

/* DELETE */
function deleteRecord(id){
 if(!confirm("DELETE THIS RECORD?"))return;
 let tx=db.transaction("documents","readwrite");
 tx.objectStore("documents").delete(id);
 tx.oncomplete=()=>{previewBox.style.display="none";showRecords();}
}

/* DOWNLOAD PASSWORD */
function openPass(data,name){downloadData=data;downloadName=name;passInput.value="";passOverlay.style.display="block";}
function closePass(){passOverlay.style.display="none";}
function checkPassword(){if(passInput.value!==DOWNLOAD_PASSWORD){alert("WRONG PASSWORD");return;}closePass();let a=document.createElement("a");a.href=downloadData;a.download=downloadName;a.click();}
</script>

</body>
</html>
